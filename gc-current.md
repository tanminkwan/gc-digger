# 코어뱅킹 시스템 GC 로그 정밀 분석 (IBM J9 / AIX)

> 분석 대상: `verbosegc` XML 로그 (발췌) — 2025-06-08 \~ 2025-06-09 사이 이벤트 중심.&#x20;

---

## 목차

1. [플랫폼 & JVM 옵션](#플랫폼--jvm-옵션)
2. [힙 레이아웃 & 정책](#힙-레이아웃--정책)
3. [GC 주기 & 정지 시간(파즈)](#gc-주기--정지-시간파즈)
4. [할당량 & 처리량(throughput)](#할당량--처리량throughput)
5. [승격(tenuring) & 세대 간 상호작용](#승격tenuring--세대-간-상호작용)
6. [레퍼런스/파이널라이저 상태](#레퍼런스파이널라이저-상태)
7. [리스크 신호 요약](#리스크-신호-요약)
8. [튜닝 제안 (IBM J9 SR4 범위 내)](#튜닝-제안-ibm-j9-sr4-범위-내)
9. [체크리스트](#체크리스트)

---

## 플랫폼 & JVM 옵션

* **OS/CPU/메모리**

  * OS: **AIX 7.2**, Arch: **ppc64**, CPU: **88 코어**, RAM: **\~180 GiB** (193,273,528,320 B).
  * 페이지 크기: **64 KiB**(0x10000), **CompressedRefs: true**.&#x20;
* **IBM J9 런타임**

  * `java.runtime.version=pap6480sr4fp11-20170823_01 (SR4 FP11)` — 사용 정책/옵션 해석은 **IBM J9 SR4** 기준.&#x20;
* **GC 정책/힙 크기**

  * **`-Xgcpolicy:gencon`** (세대별 GC)
  * **`-Xms5120m` = `-Xmx5120m`** (5 GiB 고정 힙, 초기=최대) — 내부 헤더에도 `initialHeapSize = maxHeapSize = 0x140000000`로 명시.&#x20;
* **기타 핵심 옵션(발췌)**

  * `-verbose:gc`, `-Xverbosegclog:...`, `-Xverify:none`, `-Xdump:system:...`, `-Djava.net.preferIPv4Stack=true` 등.
  * GC 스레드: **64** (`gcthreads=64`).&#x20;

> 전체 VM 인자 목록은 로그의 `<vmargs>` 섹션에 상세히 포함되어 있습니다.&#x20;

---

## 힙 레이아웃 & 정책

* **Gencon 기본 구획(샘플 시점 기준)**

  * **Nursery** 총 **1,342,177,280 B (\~1.25 GiB)**

    * `allocate` 영역: \~1.125 GiB, `survivor` 영역: **128 MiB**.
  * **Tenure** 총 **4,026,531,840 B (\~3.75 GiB)**

    * SOA(일반): \~3.56 GiB, LOA(대형 객체): **192 MiB**.
  * LOA는 \*\*항상 free=100%\*\*로 관찰 — 대형 객체는 거의 없거나 많이 생존하지 않음.&#x20;
* **관찰 요약**

  * Young 컬렉션(**Scavenge**)만 반복적으로 발생(발췌 구간).
  * Scavenge 직후 **Nursery free \~88–99%**, **Tenure free \~47%**(→ Tenure 사용률 \~53%) 근방에서 안정.&#x20;

---

## GC 주기 & 정지 시간(파즈)

* **주기(예시)**: `cycle-start intervalms`가 **\~8–18초** 분포(예: 10,128 ms, 15,204 ms, 18,218 ms 등).&#x20;
* **정지 시간(예시)**: `gc-end durationms`가 **\~8–13 ms**가 대부분, 드물게 **\~25–26 ms** 피크(예: 25.821 ms).
  → **p95 ≈ 수 십 ms 이하**, **피크도 <30 ms**로 매우 양호.&#x20;
* **해석**: 64개 병렬 GC 스레드와 큰 Nursery가 결합되어 **낮은 파즈**를 달성. 워크로드 특성상 짧고 규칙적인 Scavenge로 서비스 지연 영향이 작음.

---

## 할당량 & 처리량(throughput)

* 각 사이클의 `allocation-stats totalBytes`는 **\~1.19 GB** 수준으로 반복.&#x20;
* **평균 할당률(샘플 계산)**

  * 예) `1.19 GB / 10.128 s ≈ 117 MB/s`, `1.19 GB / 15.204 s ≈ 78 MB/s`.
  * 구간별 변동은 있으나 **수 십–100 MB/s** 범위에서 안정적.&#x20;
* **의미**: 이 수준의 처리량에서도 Scavenge 파즈가 낮게 유지 → **GC 오버헤드 비율 매우 낮음**(대략 0.1% 내외 체감).

---

## 승격(tenuring) & 세대 간 상호작용

* `gc-op` 내 **tenure로 복사된 바이트가 매우 작음**(수 십–수 백 KB 수준 기록 다수) → **승격률 낮음**, 대다수 객체가 Young에서 단명.&#x20;
* `scavenger-info`의 `tenureage=9–14`, `tiltratio=90` 관찰 → **적극적 Scavenge, 신중한 승격** 전략이 유지.&#x20;
* **Remembered Set** 카운트는 **\~6,6xx–8,8xx** 범위에서 진동 → **세대 간 참조는 보통 수준**이며 GC 후 안정적으로 감소.&#x20;

---

## 레퍼런스/파이널라이저 상태

* **Soft/Weak/Phantom**

  * Soft: 후보 다수이나 `cleared=0`가 반복 — 메모리 압박이 낮아 Soft 참조는 유지.
  * Weak/Phantom: 소량이 꾸준히 처리.&#x20;
* **파이널라이저 대기열(pending-finalizers)**

  * 시스템 큐가 **\~50–90** 선에서 유지 — **백로그 누적 징후 없음**.&#x20;

---

## 리스크 신호 요약

* **Major(전역) GC 부재**: 발췌 구간에서는 Global/tenure 컬렉션이 관찰되지 않음 → 좋은 신호. 다만 **전체 기간** 확인은 필요.&#x20;
* **LOA 100% free**: 대형 객체로 인한 조기 파편화/확장 위험 낮음.&#x20;
* **Tenure 점유 \~47–53% 유지**: 안정적. 단, **장기 트렌드**에서 상승하지 않는지 모니터 권장.&#x20;

---

## 튜닝 제안 (IBM J9 SR4 범위 내)

> 현재 상태는 **아주 건강**합니다. 엄격한 지연 SLA(예: <10 ms) 또는 메모리 절감 목표가 없다면 **현행 유지**가 합리적입니다. 그럼에도 불구하고, 아래는 “필요할 때” 적용을 검토할만한 안전한 선택지입니다.

1. **Nursery 크기 미세 조정 (`-Xmn` / `-Xmns`, `-Xmnx`)**

   * 목표가 **더 짧은 파즈**라면 Nursery를 **소폭 축소** → Scavenge는 더 자주 일어나나 **개별 파즈는 더 짧아짐**.
   * 반대로 **처리량 극대화/배치성 트랜잭션**이면 Nursery를 **소폭 확대**해 빈도를 낮출 여지.
   * 현재 파즈(대부분 8–13 ms, 피크 \~26 ms)는 이미 우수하므로 **변경은 필요 시에만**.&#x20;
2. **고정 힙 유지** (`-Xms = -Xmx = 5 GiB`)

   * 이미 적용되어 **메모리 확장/수축 오버헤드 제거**. 코어뱅킹처럼 예측성 중요한 워크로드에 적합.&#x20;
3. **Large Page 검토 (`-Xlp`)**

   * AIX에서 Large Page 설정이 인프라 차원에서 준비되어 있다면 **TLB 미스 감소**로 유리할 수 있음. (시스템 정책/권한 선확인 필수)
4. **관측 기반 승격 임계 검토**

   * 승격률이 매우 낮아 현재 기본값이 적합. 향후 Tenure 사용률이 상승한다면 **Nursery/Survivor 비율 조정** 정도만 고려.

---

## 체크리스트

* [ ] **전 기간** 로그에서 Global(tenure) GC 유무/주기 확인
* [ ] **Tenure 사용률** 장기 추세(>60% 지속 상승 여부)
* [ ] **파즈 p99**(업무 피크 시간대) 수집 — SLA 연동
* [ ] **대형 객체 패턴**(LOA 사용 징후) 변화 모니터링
* [ ] **Soft/Weak 참조** 클리어율 변화(메모리 압박 신호)

---

### 한 줄 결론

* **Gencon + 5 GiB 고정 힙 + 64 GC 스레드** 환경에서 **Young-only Scavenge**가 **\~8–13 ms** 파즈로 규칙적으로 돌며, 사이클당 **\~1.19 GB**를 처리하고 **승격률은 매우 낮음**. **현재 설정은 코어뱅킹 워크로드에 적합**하며, 특별한 지연/메모리 이슈가 없다면 **현행 유지**가 모범 답안입니다.&#x20;

> 필요하시면, 전체 로그를 기준으로 **p50/p95/p99 파즈, 평균 할당률, 승격률, Tenure 점유 추이**까지 수치 테이블로 뽑아 드릴게요.
